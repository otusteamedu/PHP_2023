# Кейсы тестирования

## Исходные данные
- `фронт`
  - отправка с формы на `бэк` json объекта,
    содержащий текстовые поля `card_number` (номер карты, 16 цифр, считаем,
    что валидный номер всегда содержит 16 цифр, валидность номера по
    алгоритму Луна проверять не нужно), `card_holder` (владелец карты, имя и
    фамилия латиницей, может также содержать дефис), `card_expiration`
    (месяц/год окончания действия карты в формате мм/гг), `cvv` (код с обратной
    стороны карты, 3 цифры), `order_number`(номер заказа, до 16 произвольных
    символов), `sum` (сумма оплаты, разделитель дробной и целой части запятая,
    поэтому и строка, а не число).
  - отображение ошибок полученных от `бека`
- `бэк`
  - проверка входных данных с `фронта`, возврат ошибок с кодом `400`
  - отправка запроса в `сервис А`
    - при ошибке вернуть ее на `фронт` с кодом `400`
    - успех - вызвать метод `setOrderIsPaid(string $orderNumber, float $sum): bool` `репозитория`  
- `сервис А`
  - успех - возврат ответа с кодом `200`
  - ошибка - возврат ответа с кодом `403`
- `репозиторий`
  - метод `setOrderIsPaid(string $orderNumber, float $sum): bool` проверяет соответствие номера заказа и его суммы и 
    возвращает `true`, если успешно. Иначе выбрасываются различные исключения.

## Модульные тесты

1. `бэк`:
   1. Проверка входных данных:
      1. Если поле `card_number` не соответствует шаблону `^\d{16}$` - вернуть ответ с кодом `400` и полем `card_number`.
      1. Если поле `card_holder` не соответствует шаблону `^\[A-Za-z]+ [A-Za-z]+$` - вернуть ответ с кодом `400` и полем `card_holder`.
      1. Проверка поля `card_expiration`:
         1. Не соответствует шаблону `^\d{2}/\\d{2}$` - вернуть ответ с кодом `400` и полем `card_expiration`.
         1. Если `MM` в поле `card_expiration` меньше `0` или больше `12` - вернуть ответ с кодом `400` и полем `card_expiration`.
         1. Если `MM-ГГ` в поле `card_expiration` меньше текущего месяца и года - вернуть ответ с кодом `400` и полем `card_expiration`.
      1. Если поле `cvv` не соответствует шаблону `^\d{3}$` - вернуть ответ с кодом `400` и полем `cvv`.
      1. Если поле `order_number` не соответствует шаблону `^.{16}$` - вернуть ответ с кодом `400` и полем `order_number`.
      1. Если поле `sum` не соответствует шаблону `^\d+(,\d{1,2})?$` - вернуть ответ с кодом `400` и полем `sum`.
   1. Проверка ответов от `сервиса А`:
      1. Ответ от сервиса с кодом `403` - вернуть ответ с кодом `400` и сообщением об ошибке.
      1. Ответ от сервиса с кодом `200` - вызвать метод `репозиторий::setOrderIsPaid`.
   1. Проверка возвращаемого результата от `репозиторий::setOrderIsPaid`:
      1. `true` - вернуть ответ с кодом `200`.
      1. `false` - вернуть ответ с кодом `400` и сообщением об ошибке.
      1. Выброшено исключение:
         1. `orderNumber` не найден - вернуть ответ с кодом `400` и сообщением об ошибке и полем `order_number`.
         1. `sum` не соответствует - вернуть ответ с кодом `400` и сообщением об ошибке и полем `sum`.
         1. иное - вернуть ответ с кодом `400` и сообщением об ошибке.
1. `репозиторий`:
   1. При пустых/нулевых параметрах `orderNumber` или `sum` - выбросить исключение о неверных параметрах
   1. `orderNumber` отсутствует - выбросить исключение `orderNumber` не найден
   1. `sum` не соответствует - выбросить исключение `sum` не соответствует

## Интеграционные тесты
1. `бэк - фронт`:
   1. Отображение ошибок, получение ответов с кодом `400`:
      1. В ответе имеется поле `card_number` - выделяем поле `номер карты` красной рамкой, отображаем сообщение об 
        ошибке - не корректный номер карты.
      1. В ответе имеется поле `card_holder` - выделяем поле `владелец карты` красной рамкой, отображаем сообщение об
         ошибке - не корректный владелец карты.
      1. В ответе имеется поле `card_expiration` - выделяем поле `окончание действия карты` красной рамкой, отображаем сообщение об
         ошибке - не корректный срок окончание действия карты.
      1. В ответе имеется поле `cvv` - выделяем поле `cvv` красной рамкой, отображаем сообщение об
         ошибке - не корректный cvv.
      1. В ответе имеется поле `order_number` - выделяем поле `номер заказа` красной рамкой, отображаем сообщение об
         ошибке - не корректный номер заказа или сообщение из ответа.
      1. В ответе имеется поле `sum` - выделяем поле `сумма` красной рамкой, отображаем сообщение об
         ошибке - не корректная сумма или сообщение из ответа.
      1. В ответе имеется сообщение об ошибке - отобразить сообщение об ошибке.
      1. Пустой ответ - отобразить сообщение об ошибке, по умолчанию.
   1. Получен ответ с кодом `200` - отобразить сообщение об успехе.
1. `бэк - сервис А - репозиторий`:
   1. При верных входных данных и ответа от `сервиса А` с кодом `200` - должен вернуться ответ с кодом `200`
   1. При верных входных данных и ответа от `сервиса А` с кодом `403` - должен вернуться ответ с кодом `400`
   2. При верных входных данных для `сервиса А` и не верными данными для `репозитория` и ответом от `сервиса А` с 
      кодом `200` - должен вернуться ответ с кодом `400`

## Системные тесты
1. Если введены не корректные данные (по формату), то после получения ответа от `бэка` на `фронте` должно отобразиться сообщение
   об ошибке и выделены поля с ошибками.
1. Если списание с карты не удалось, то после получения ответа от `бэка` на `фронте` должно отобразиться сообщение
   об ошибке.
1. Если списание с карты успешно, но не корректные номер заказа или сумма, то после получения ответа от `бэка` на `фронте` должно отобразиться сообщение
   об ошибке и выделены поля с ошибками.
1. Если списание с карты успешно, и корректные данные заказа , то после получения ответа от `бэка` на `фронте` должно отобразиться сообщение
   об успешном выполнении.
