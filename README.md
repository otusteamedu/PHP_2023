# PHP_2023

https://otus.ru/lessons/razrabotchik-php/?utm_source=github&utm_medium=free&utm_campaign=otus

# Задание

## Цель
Мы научимся строить асинхронное приложение на практике.
Задача состоит в том, чтобы научиться применять очередь, увидеть её преимущества и недостатки.

## Описание/Пошаговая инструкция выполнения домашнего задания
Пишем приложение обработки отложенных запросов.

- Создать простое веб-приложение, принимающее POST запрос из формы от пользователя. Например, запрос на генерацию банковской выписки за указанные даты. Обычно такие запросы (в реальных системах) работают довольно долго, поэтому пользователя надо оповестить о том, что запрос принят в обработку
- Форма должна подразумевать отправку оповещения по результатам работы
- Передать тело запроса в очередь
- Написать скрипт, который будет читать сообщения из очереди и выводить информацию о них в консоль
- Реализация оповещения
- Сгенерированный ответ отправить через email или telegram
- Приложить инструкцию по запуску системы

# Установка

## Изолированное окружение

Для развёртывания изолированного окружения пропишите команду
```bash
vagrant up
```

После установки, зайдите в ОС
```bash
vagrant ssh
```

## Настройка телеграм бота
Для настройки телеграм бота, вам необходимо создать бота и получить токен.
Для этого, вам необходимо написать боту `@BotFather` и выполнить команду `/newbot`

Далее напишите новому боту сообщение `/my_name @my_bot` и перейдите по ссылке `https://api.telegram.org/bot<token>/getUpdates`, и получите `chat_id`

## Подготовка и запуск среды
```bash
cd /vagrant/application && cp .env.example .env
```

Далее, заполните все пустые строки нужными данными в файле `.env`

После чего выполните команду

```bash
sudo docker compose up -d
```

Добавьте сайт `mysite.local` в файл `hosts`
```bash
127.0.0.1 mysite.local
```

Готово!

# Использование

Для того, чтобы отправить запрос, перейдите по ссылке `http://mysite.local/?accountNumber=12345&startDate=2023-01-01&endDate=2023-05-27`

Для запуска consumer-а, выполните команду
```bash
sudo docker compose exec fpm bash
php console.php receive.php
```
