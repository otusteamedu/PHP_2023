# Проект до рефакторинга

Код до рефакторинга можно посмотреть в [этой ветке](https://github.com/otusteamedu/PHP_2023/tree/ATashmatov/hw12)

## Проблемы

### 1. Нет стандартизации в структуре проекта

Код хоть и разделён на какие-то слои, но они никак не стандартизированы.
Поэтому если появится в проекте ещё какая-то фича, она так же будет разбросана по папкам.
С каждым разом будет всё сложнее добавлять какие-либо фичи, придётся долго думать куда их складывать.

### 2. Нет никакого управления зависимостями

Мы не контролируем зависимости между слоями, не контролируем направление этих зависимостей.
Что в будущем усложнит изменение каких-то частей проекта.

### 3. Нарушение SRP

Многие классы нарушают принцип единой ответственности.
Например, класс `RedisEventProvider` - занимается и сохранением событий в редис, и сериализацией.

### Нарушение DIP
Внутри класса `RedisEventProvider` хоть и не создаётся явная зависимость - клиент редиса, но она требуется.
Если в будущем понадобится сменить клиент `PRedis` на `extension`, то нам придётся изменять весь код.

# Проект после рефакторинга

В текущей ветке лежит код после рефакторинга

## Решение проблем

1. Применил подход `Чистая архитектура` для организации проекта.
Разделил код на слои: Domain, Application, Infrastructure.

2. Добавил статический анализатор зависимостей - `deptrack`.
Указал в дептраке что `Domain` не зависит ни от чего.
`Application` зависит только от `Domain`. `Infrastructure` зависит от слоя `Application`.
Теперь направление зависимостей контролируется явно.

3. Разнёс код по разным классам. Гидрацией занимается отдельный класс гидратор, за сохранение отвечает репозиторий.

4. Заменил явные зависимости на интерфейсы.
Сами зависимости создаются и конфигурируются на самом начальном этапе в файле `index.php`
и затем прокидываются в приложение.
