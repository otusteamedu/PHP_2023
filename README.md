# Домашнее задание "Архитектура кода"

В примере представлен класс для оплаты заказа экскурсионной программы. Под Order`ом в данном коде подразумевается некий билет на экскурсию. Бизнесу необходимо реализовать онлайн оплату посредством интернет-эквайринга от Сбербанка.

Рассматриваемый класс \Imitronov\Hw15\OldProject\Models\Sberpay.

Исправленная версия располагается в неймспейсе \Imitronov\Hw15\Refactored.

## Нарушения принципов SOLID:
- Принцип единой ответственности. Класс занимается вытягиванием заказа из базы данных, созданием нового платежа с сохранением его в БД, отправкой запроса в сбербанк, конфигурированием окружения через ini_set.
- Принцип открытости/закрытости. Весь код завязан на нескольких доменных сущностях, имеет захардкоженное описание платежа, id ответственного сотрудника. Реализация запросов завязана на использование curl. Имеет довольно много причин для редактирования и мало возможностей для расширения функционала.
- Принцип подстановки Барбары Лисков. Создание наследников будет довольно сложным, так как функционал класса размазан. Накосячить и нарушить принцип будет довольно-таки легко. К тому же отсутствует какая-либо абстракция над классом.
- Принцип разделения интерфейса. Класс не реализует никакие интерфейсы.
- Принцип инверсии зависимостей. В классе объединены всевозможные слои приложения. Разделения на абстракции и детали отсутствует. В остальном приложении использование такой реализации полностью нарушит архитектуру.

## Нарушения KISS:
- Работу с CURL можно было заменить использование библиотеки для http запросов, наподобии symfony/http-client, guzzlehttp/guzzle, yiisoft/yii2-httpclient. Это облегчило бы формирование и отправку запросов. И позволило бы не завязываться на реализации с CURL.

## Нарушения DRY:
- В случае введения новых сущностей для оплаты (доп. сбор, услуги фотографа и т.д.) есть возможность задублировать код работы с самим банком (регистрация платежа, проверка статуса).

## Исправления:
- Создать интерфейс PaymentGatewayInterface для работы с платежами через банковские системы.
- Разработать DTO для регистрации платежа в банковской системе и проверки статуса платежа.
- Создать UseCase для оплаты заказа с использованием реализации PaymentGatewayInterface.
- Использовать ValueObject для типизации данных, Repository для работы с доменными сущностями.
- Передавать конфигурацию внутрь класса средствами фреймворка через .env переменные.
