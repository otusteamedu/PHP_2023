version: '3'

services:
    application:
        build:
            context: ./docker/php-fpm
        image: php-hw/php-fpm
        environment:
            - PHP_IDE_CONFIG=serverName=php-hw
        volumes:
            - ./:/data/application.local
            - ./docker/php-fpm/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini
        working_dir: /data/application.local
        networks:
            - php-hw-network

    elasticsearch:
        image: docker.elastic.co/elasticsearch/elasticsearch:8.12.0
        container_name: elasticsearch
        environment:
            - cluster.name=docker-cluster
            - bootstrap.memory_lock=true
            - discovery.type=single-node
            - "ES_JAVA_OPTS=-Xms8g -Xmx8g"
            - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
            - cluster.routing.allocation.disk.threshold_enabled=false
        ulimits:
            memlock:
                soft: -1
                hard: -1
        volumes:
            - es_data_11:/usr/share/elasticsearch/data
        ports:
            - 9200:9200
            - 9300:9300
        networks:
            - php-hw-network

volumes:
    es_data_11:

networks:
    php-hw-network:
        driver: bridge
