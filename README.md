# PHP_2023

https://otus.ru/lessons/razrabotchik-php/?utm_source=github&utm_medium=free&utm_campaign=otus

# Задание

## Цель
Потренироваться в написании сложных SQL-запросов поверх схемы для проверки правильности структуры.
Усилить схему гибким хранением значений различного типа без нарушения нормализации.

## Описание/Пошаговая инструкция выполнения домашнего задания:
Спроектировать EAV-хранение для базы данных кинотеатра

4 таблицы: фильмы, атрибуты, типы атрибутов, значения.

Типы атрибутов и соответствующие им атрибуты (для примера):


* рецензии (текстовые значения) - рецензии критиков, отзыв неизвестной киноакадемии ...
* премия (заменяется при печати баннеров и билетов на изображение, логическое значение) - оскар, ника ...
* "важные даты" даты (при печати - наименование атрибута и значение даты, тип дата) - мировая премьера, премьера в РФ ...
* служебные даты (используются при планировании, тип дата) - дата начала продажи билетов, когда запускать рекламу на ТВ ...

* View сборки служебных данных в форме:
фильм, задачи актуальные на сегодня, задачи актуальные через 20 дней
* View сборки данных для маркетинга в форме (три колонки):
фильм, тип атрибута, атрибут, значение (значение выводим как текст)

## Критерии оценки:

* Учтены все допустимые типы данных;
* Учтена специфика хранения и последующего использования float-данных;
* EAV-схема оснащена индексами.

# Установка

## Изолированное окружение

Для развёртывания изолированного окружения пропишите команду
```bash
vagrant up
```

После установки, зайдите в ОС
```bash
vagrant ssh
```

## Подготовка и запуск среды
```bash
cd application && cp .env.example .env
```

Далее, заполните все пустые строки нужными данными в файле `.env`

Перед запуском контейнеров, командой ниже обратите внимание на это уточнение:

Если ранее вами уже создавались контейнеры в этом окружении, то нужно удалить `volume` базы данных, для того, чтобы новые данные корректно добавились. Для этого проверьте наличие этого `volume`

```bash
sudo docker volume ls | grep 'myapp-pgvolume'
```

Если он есть, выполните следующую команду:

```bash
sudo docker volume rm <название из результата выше>
```

После чего можете запускать команду:

```bash
sudo docker compose up -d
```

## Заполнение данных в бд

Выполните команду:

```bash
sudo docker container exec -it myapp-postgres-dev bash
```

Для того чтобы перейти к контейнеру с базой данных.

Далее, в контейнере выполните команду:

```bash
dropdb -U postgres mydb && psql -U postgres -f docker-entrypoint-initdb.d/pgdump_2023_10_12.sql
```

для того, чтобы заполнить базу данных

# Работа с бд

Подключение к бд:

```bash
psql -U postgres -d mydb
```

Вывод всех таблиц:

```bash
\dt
```

Вывод всех view:

```bash
\dv
```

Вывод структуры таблицы:

```bash
\d <название таблицы>
```