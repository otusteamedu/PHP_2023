## Unit-тестирование

---

### Вводные данные:

Поставлена задача реализовать бэк для страницы оплаты
просмотра фильма через некий платёжный сервис А.

---

### Client Request:

* `card_number` - 16 цифр;
* `card_holder` - имя и фамилия латиницей, может также содержать дефис;
* `card_expiration` - месяц/год в формате мм/гг;
* `cvv` - 3 цифры,
* `order_number` - от 12 до 16 произвольных символов;
* `sum` - сумма оплаты, разделитель дробной и целой части запятая.

---

### Backend controller:

* Валидация данных. Если в данных есть ошибка, то возвращает
  сообщение об ошибке с **кодом 400**;
* Передача данных в API-запросе к сервису **A**:
    * В случае ошибки, возврат на фронт ошибки с **403 HTTP кодом**;
    * В случае успешного списания денег необходимо записать в БД
      информацию об успешной оплате.

---

### Задача:

Предлагается описать кейсы тестирования данной задачи для трёх уровней:
модульного, интеграционного и системного. Считаем, что взаимодействуют
4 «модуля»:

* backend;
* frontend;
* repository;
* A service.

**Кейсы тестирования:**

1. Модульные тесты:
    * Если `card_number` содержит символы, отличающиеся от цифр, то тестируемый метод возвращает `CardNumberValidationException` с сообщением об ошибке;
    * Если `card_number` содержит более или менее 16 цифр, то тестируемый метод возвращает `CardNumberValidationException` с сообщением об ошибке;
    * Если `card_holder` содержит более одного пробела, то тестируемый метод возвращает `CardHolderValidationException` с сообщением об ошибке;
    * Если `card_holder` **имя** не валидно, то тестируемый метод возвращает `CardHolderValidationException` с сообщением об ошибке;
    * Если `card_holder` **фамилия** не валидно, то тестируемый метод возвращает `CardHolderValidationException` с сообщением об ошибке;
    * Если `card_expiration` предоставлено не в верном формате, то тестируемый метод возвращает `CardExpirationValidationException` с сообщением об ошибке;
    * Если `card_expiration` значение менее текущей даты, то тестируемый метод возвращает `CardExpirationValidationException` с сообщением об ошибке;
    * Если `cvv` содержит не 3 цифры, то тестируемый метод возвращает `CvvValidationException` с сообщением об ошибке;
    * Если `order_number` содержит не 12-16 произвольных символов, то тестируемый метод возвращает `OrderNumberValidationException` с сообщением об ошибке;
    * Если `sum` значение не валидно, то тестируемый метод возвращает `SumValidationException` с сообщением об ошибке.
2. Интеграционные тесты:
    * frontend - backend:
        * Если card_holder содержит более одного пробела, то после получения ответа от бэка на фронте выделяется поле «Владелец карты» красной рамкой;
        * Если card_number содержит символы, отличающиеся от цифр, то после получения ответа от бэка на фронте выделяется поле «Номер карты» красной рамкой.
    * backend - repository:
        * В случае успешного списания денег в БД создается новая запись, содержащая информацию об успешной оплате;
        * В случае ошибки списания денег в БД не создается новая запись.
3. Системные тесты:
    * Если `cvv` неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке `Не удалось списать данные с карты, проверьте реквизиты`;
    * Если `order_number` неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке `Не удалось найти заказ по данному номеру`.