# Кейсы тестирования

## Модульные тесты

1. Если длина card_number (после удаления пробелов) не равна 16 символам,
   то тестируемый метод возвращает 400 с сообщением об ошибке.

2. Если card_number содержит пробельные символы, то просто удаляем их.

3. Если card_number содержит не численные символы, разделяющие пробелы и пробелы по краям строки,
   то тестируемый метод возвращает 400 с сообщением об ошибке.

4. Проверка поля card_holder. Если одна из проверок не проходит, то тестируемый метод возвращает 400 с сообщением об ошибке.
   1. Если card_holder содержит более одного пробела
   2. Если card_holder пустая строка
   3. Если card_holder содержит не два слова (больше двух или меньше)
   4. Если card_holder содержит не только символы латинского алфавита и одного разделяющего пробела
   5. Если card_holder не является строкой
   6. Если card_holder слишком длинный (например, больше 50 символов)

5. Если card_holder является строкой в нижнем регистре, то переводим её в верхний.

6. Если card_holder содержит пробельные символы по краям строки, то обрезаем их.

7. Если card_expiration имеет некорректный формат (мм/гг),
   то тестируемый метод возвращает 400 с сообщением об ошибке.

8. Если cvv содержит не числовые символы (0-9),
   то тестируемый метод возвращает 400 с сообщением об ошибке.

9. Если длина cvv не равна трём символам (после обрезки пробелов),
   то тестируемый метод возвращает 400 с сообщением об ошибке.

10. Если cvv содержит по краям пробельные символы, то должна вернуться обрезанная строка. 

11. Если order_number состоит из более чем 16 символов,
    то тестируемый метод возвращает 400 с сообщением об ошибке.

12. Если order_number пустая строка,
    то тестируемый метод возвращает 400 с сообщением об ошибке.

13. Если sum не является числовой строкой с единственным допустимым символом - запятая,
    то тестируемый метод возвращает 400 с сообщением об ошибке.
14. Если sum начинается с ведущих нулей,
    то тестируемый метод возвращает 400 с сообщением об ошибке.

## Интеграционные тесты

1. Проверяем связку "фронт-бэк":
    1. Отправляем запрос с корректными данными на бэк, ожидаем HTTP-код 200 и успешное выполнение операции.
    2. Отправляем запрос с некорректными данными на бэк, ожидаем HTTP-код 400 и соответствующее сообщение об ошибке.
       Убеждаемся, что фронт выделяет соответствующее поле красной рамкой.

2. Проверяем связку "бэк-репозиторий":
   1. Отправляем успешный запрос на списание денег в бэк, и проверяем, что метод репозитория setOrderIsPaid вызывается один раз и возвращает true.
   2. Отправляем запрос на списание денег в бэк, вызываем метод репозитория setOrderIsPaid с несоответствующим номером заказа, и проверяем, что метод setOrderIsPaid бросает исключение.

## Системные тесты

1. Если CVV неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке "Не удалось списать данные с карты, проверьте реквизиты".

2. Если списание денег не удалось (HTTP-код 403 от сервиса A), то после получения ответа от бэка на фронте выводится сообщение об ошибке, которую прислал сервис А.

3. При успешной оплате (HTTP-код 200 от сервиса A) убеждаемся, что информация об успешной оплате записана в базу данных и на фронте произошёл редирект на страницу с сообщением об успешной оплате или на страницу с доступом к фильму.
