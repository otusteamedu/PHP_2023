
Перед началом тестирования, нужно создать в тестируемой системе фильм с минимальной стоимость, которую сможет успешно обработать сервис А. Например, 1 копейка. Таким образом при многочисленных успешных оплатах будут минимальные денежные затраты на тестирование.


# Модульные тесты.

На бэке нет какой-либо бизнес логики (каких-либо алгоритмов) кроме валидации. Кроме валидации на бэке есть только взаимеодействие с сервисом А и с репозиторием. Корректность этих взаимодействий будет протестирована в интеграционных тестах.

Везде ниже, под "пробельными символами" понимается символ пробела или символ табуляции.

## Подготовка к проведению модульного тестирования

Для проведения модульного тестирования, вместо сервиса А и вместо репозитория делаем заглушки, всегда возвращающие успешный ответ.

Тестирование будет выполняться путем HTTP запросов к API бэка.

## Список модульных тестов

* Заполняем все поля валидными данными. Тестируемый метод возвращает 200, с полями подтверждающими что оплата прошла и успешно зафиксирована в БД.
* Тестируем поле card_holder. Все остальные поля заполняем корректными данными.
    * Если card_holder содержит более одного пробела, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит более одного дефиса, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит дефис в качестве первого (или последнего) непробельного символа, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит пробельные символы в начале или в конце строки, то тестируемый метод возвращает 200 с полями подтверждающими что оплата прошла и успешно зафиксирована в БД.
    * Если card_holder содержит нелатинские буквы, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит небуквенные символы кроме дефиса (знаки препинания, спец символы, смайлики и прочее), то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит только дефис и пробельные символы, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит только дефис, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит только пробельные символы, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder содержит менее трех латинских букв идущих подряд, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_holder пусто, то тестируемый метод возвращает 400 с сообщением об ошибке.
* Тестируем поле card_number. Все остальные поля заполняем корректными данными.
    * Если card_number пусто, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_number содержит менее 16 цифр, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_number содержит более 16 цифр, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_number содержит символ, не являющийся цифрой (кроме пробелов в начале и в конйе строки), то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_number содержит 16 цифр, но в начале или в конце строки есть пробельные символы, то тестируемый метод возвращает 200 с полями подтверждающими что оплата прошла и успешно зафиксирована в БД.
* Тестируем поле card_expiration. Все остальные поля заполняем корректными данными.
    * Если card_expiration пусто, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_expiration содержит недопустимый номер меcяца (например, "00", или номер, больше "12"), то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_expiration содержит номер года текущего "23", или более "33", то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если в card_expiration до слэша или после слэша задано менее одной цифры или более двух цифр, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если card_expiration корректный формат месяца/года, но в начале или в конце строки есть пробельные символы, то тестируемый метод возвращает 200 с полями подтверждающими что оплата прошла и успешно зафиксирована в БД.
* Тестируем поле cvv. Все остальные поля заполняем корректными данными. Все тесты полностью аналогичны тестам для поля card_number. Единственное исключение - проверяем чтобы в поле было не ровно 16 цифр, а ровно 3 цифры.
* Тестируем поле order_number. Все остальные поля заполняем корректными данными.
    * Если order_number пусто, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если order_number содержит более 16 символов, то тестируемый метод возвращает 400 с сообщением об ошибке.
* Тестируем поле sum. Все остальные поля заполняем корректными данными.
    * Если sum пусто, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если sum содержит число <=0, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если sum содержит пробельные символы в начале или в конце строки, то тестируемый метод возвращает 200 с полями подтверждающими что оплата прошла и успешно зафиксирована в БД.
    * Если sum содержит символы, не являющиеся цифрами или запятой, то тестируемый метод возвращает 400 с сообщением об ошибке.
    * Если sum содержит число менее "0,01" , то тестируемый метод возвращает 400 с сообщением об ошибке.



# Интергационные тесты

## Проверяем связку «фронт-бэк»

### Подготовка к проведению тестирования

* Отключаем маски и валидацию на инпутах формы.
* Ставим заглушку вместо платежной системы: зашиваем в заглушку конкретную карту. Для этой карты всегда будет успешный ответ. Для всех остальных карт - ошибка.
* Ставим заглушку вместо репозитория. Заглушка будет всегда возвращать успешный ответ.


### Список тестов

* Проверяем каждое поле в отдельном тесте. В каждом тесте заполняем валидными данными все поля кроме проверяемого. Используем данные, зашытые в заглушку платежонй системы. Например, если card_number содержит номер карты в некорректном формате, то после получения ответа от бэка на фронте выделяется поле «Номер карты» красной рамкой. Выполняем по аналогичному тесту для каждого поля формы.

* Вводим данные карты, зашитой в заглушке платежной системы. На форме появляется подтверждение, что оплата прошла успешно. И при этом разблокируется доступ к оплаченному фильму.


## Проверяем связку «бэк-сервис A»

### Подготовка к проведению тестирования

* Отключить валидатор на бэке, чтобы он передавал любые принимаемые данные на сервис А.
* Ставим заглушку вместо репозитория. Заглушка будет всегда возвращать успешный ответ.
* все тесты выполняются без участия фронта путем отправки HTTP запросов к API бэка.

### Список тестов

* Передать в корректном формате все поля реальной карты. Указать корректную сумму. Тестируемый метод возвращает 200 с полями подтверждающими что оплата прошла и успешно зафиксирована в БД. При этом, с карты должны списаться указаная сумма.

* Проверяем каждое поле в отдельном тесте. В каждом тесте заполняем валидными данными все поля кроме проверяемого. Используем данные реальной карты. Например, если card_number содержит номер карты в некорректном формате, то тестируемый метод возвращает 400 с сообщением об ошибке из платежного сервиса. Выполняем по аналогичному тесту для каждого поля формы. Если платежная система принимает любые значения в поле order_number, то не тестируем это поле данным тестом.

* Если отправляем данные просроченной карты, то тестируемый метод возвращает 400 с сообщением об ошибке из платежного сервиса.
* отправляем данные закрытой карты, то тестируемый метод возвращает 400 с сообщением об ошибке из платежного сервиса.
* отправляем данные заблокированной карты, то тестируемый метод возвращает 400 с сообщением об ошибке из платежного сервиса.
* оплатить отрицательную сумму, то тестируемый метод возвращает 400 с сообщением об ошибке из платежного сервиса.



## Проверяем связку «бэк-репозиторий»


### Подготовка к проведению тестирования

* Отключить валидатор на бэке, чтобы он передавал любые принимаемые данные в репозиторий.
* Ставим заглушку вместо сервиса А. Заглушка будет всегда возвращать успешный ответ.
* все тесты выполняются без участия фронта путем отправки HTTP запросов к API бэка.

### Список тестов

* Если два раза подряд оплатить один и тот же заказ, то тестируемый метод возвращает 400 с сообщением об ошибке в обработке заказа.
* Если передать отрицательную сумму, то тестируемый метод возвращает 400 с сообщением об ошибке в обработке заказа. (должен сработать валидатор метода репозитория)
* Если передать некорректный номер заказа (пустой, или состоящий из 100 символов), то тестируемый метод возвращает 400 с сообщением об ошибке в обработке заказа. (должен сработать валидатор метода репозитория)

* Перед началом теста поменять заглушку для платежного сервиса: чтобы платежный сервис сэмитировал оплату не той суммы, которую передали к оплате. Вызвать API метод бэка с корректными входными параметрами. Тестируемый метод возвращает 400 с сообщением об ошибке в обработке заказа. (в методе репозитория должна сработать проверка соответствия номера заказа и его суммы; этим тестом мы проверяем, что бэк может корректно обрабатывать разные ошибки репозитория и что при этом сам бэк не падает)

* Перед началом теста поменять заглушку для платежного сервиса: чтобы платежный сервис сэмитировал оплату не того номера заказа, который передали к оплате. Вызвать API метод бэка с корректными входными параметрами. Тестируемый метод возвращает 400 с сообщением об ошибке в обработке заказа. (в методе репозитория должна сработать проверка соответствия номера заказа и его суммы; этим тестом мы проверяем, что бэк может корректно обрабатывать разные ошибки репозитория и что при этом сам бэк не падает)



## Проверяем связку «фронт-бэк-сервис А»

### Подготовка к проведению тестирования

* Ставим заглушку вместо репозитория. Заглушка будет всегда возвращать успешный ответ. При этом, заглушка ничего не должна писать в БД.

### Список тестов

* На фронте заполнить данные корректно и оплатить. На фронт части должно появиться сообшение об успешной оплате. Но при переходе на страницу фильма должно появиться сообщение о том что фильм не оплачен.

* Проверяем, что можно оплатить один и тот же заказ дважды. На фронте заполнить данные корректно и оплатить. Перезагрузить страницу и снова заполнить данные корректно и оплатить. На фронт части должно появиться сообшение об успешной оплате.


## Проверяем связку «фронт-бэк-репозиторий»

### Подготовка к проведению тестирования

* Ставим заглушку вместо сервиса А. Заглушка будет всегда возвращать успешный ответ.

### Список тестов

* Перед началом теста поменять заглушку для платежного сервиса: чтобы платежный сервис сэмитировал оплату не той суммы, которую передали к оплате. На фронте заполнить данные корректно и оплатить. Должно появиться сообщение об ошибке в обработке заказа. (в методе репозитория должна сработать проверка соответствия номера заказа и его суммы)

* Перед началом теста поменять заглушку для платежного сервиса: чтобы платежный сервис сэмитировал оплату не того номера заказа, который передали к оплате. На фронте заполнить данные корректно и оплатить. Должно появиться сообщение об ошибке в обработке заказа. (в методе репозитория должна сработать проверка соответствия номера заказа и его суммы)




# Системное тестирование

## Подготовка к проведению тестирования

Поднимаем точную копию боевого сервиса. В исходный код не вносим никаких правок. Все тесты выполняются путем взаимодействия с фронтом.

## Список тестов

Пусть время сессии у сервиса будет равным 1 час. Через час сервис должен снова попросить авторизоваться.

* Загрузить страницу оплаты фильма, подождать 1 час 10 минут и отправить форму. Должно появиться сообщение об истекшей авторизации и с предложением авторизоваться снова.
* Если cvv неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке «Не удалось списать данные с карты, проверьте реквизиты»
* Если номер карты неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке «Не удалось списать данные с карты, проверьте реквизиты»
* Если владелец карты неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке «Не удалось списать данные с карты, проверьте реквизиты»
* Если дата окончания действия карты неверна, то после получения ответа от бэка на фронте выводится сообщение об ошибке «Не удалось списать данные с карты, проверьте реквизиты»
* После успешной оплаты заказа снова перейти к оплате и ввести данные для оплаты того же самого заказа (с корректными платежными реквизитами). При попытке оплатить на, должно отобразиться сообщение что заказ уже оплачен.
* Открыть сразу две вкладки со страницей оплаты одного и того же заказа. Ввести на обоих вкладках корректные реквизиты и попытаться оплатить на каждой вкладке. Первая оплата должна пройти успешно. При попытке оплатить на второй вкладке, должно отобразиться сообщение что заказ уже оплачен.
* попытаться оплатить картой "мир". Должно появиться сообщение об успешной оплате.
* попытаться оплатить картой "visa". Должно появиться сообщение об успешной оплате.
* попытаться оплатить картой "master card". Должно появиться сообщение об успешной оплате.

