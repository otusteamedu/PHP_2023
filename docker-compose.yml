version: "3.0"
services:
  nginx:
    build: ./nginx
    ports:
      - ${NGINX_PORT}:80
    volumes:
      - ./nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf
      - ./www:/www
      - phpsocket:/var/run

  php:
    build: ./php
    volumes:
      - ./php/php-fpm.d/zz-docker.conf:/usr/local/etc/php-fpm.d/zz-docker.conf
      - ./www:/www
      - phpsocket:/var/run

  redis:
    image: 'redis:alpine'
    volumes:
      - '_redis:/data'
    ports:
      - '16379:6379'

  memcached:
    image: 'memcached:alpine'
    ports:
      - '11212:11211'

  postgres:
    image: 'postgres:14-alpine'
    working_dir: /data
    volumes:
      - '_db:/data'
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=secret
      - POSTGRES_DB=postgres
    ports:
      - '5004:5432'

volumes:
  phpsocket:
  _db:
  _redis:

