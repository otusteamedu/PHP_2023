version: '3.0'

services:
    nginx:
        restart: always
        build:
            context: ./config
            dockerfile: dockerfile-nginx
        volumes:
            - ./app:/var/www/application.local
        ports: 
            - 80:80
        container_name: nginx
        networks:
            - test-network

    fpm:
        restart: always
        build:
            context: ./config
            dockerfile: dockerfile-php
        volumes:
            - ./app:/var/www/application.local
        environment:
            REDIS_HOST: redis
            MEMCACHED_HOST: memcached
            MYSQL_HOST: mysql
            MYAPP_MYSQL_DATABASE: ${MYSQL_DATABASE}
            MYAPP_MYSQL_USER: ${MYSQL_USER}
            MYAPP_MYSQL_PASSWORD: ${MYSQL_PASSWORD}
        ports:
            - :9000
        container_name: fpm
        networks:
            - test-network


    mysql:
        restart: always
        build:
            context: ./config
            dockerfile: dockerfile-mysql
        volumes:
            - ./mysql/:/docker-entrypoint-initdb.d
        environment:
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_DATABASE: ${MYSQL_DATABASE}
            MYSQL_USER: ${MYSQL_USER}
            MYSQL_PASSWORD: ${MYSQL_PASSWORD}
        ports:
            - 3306:3306
        container_name: mysql
        networks:
            - test-network

    adminer:
        restart: always
        build:
            context: /config
            dockerfile: dockerfile-adminer
        ports:
            - 8080:8080
        container_name: adminer
        networks:
            - test-network
            
    redis:
        image: redis
        container_name: redis
        networks:
            - test-network
        ports:
        - 6379:6379

    memcached:
        image: memcached
        container_name: memcached
        networks:
            - test-network
        ports:
        - 11211:11211

networks:
  test-network:
    driver: bridge