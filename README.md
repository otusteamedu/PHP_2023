# PHP_2023

https://otus.ru/lessons/razrabotchik-php/?utm_source=github&utm_medium=free&utm_campaign=otus

# Задание

Разработайте несложный REST API для сервиса рассылки SMS. SMS-сообщения должны отправляться в двух режимах:

- Режим 1: позволяет отправлять сообщения поштучно
- Режим 2: требует, чтобы сообщения отправлялись пакетами по 10 штук

Используйте паттерны:

- Адаптер: для унификации отправки сообщений через разных провайдеров (придумайте самостоятельно, как могут выглядеть запросы к провайдерам)
- Цепочка обязанностей: для отказа в отправке, если сообщение содержит стоп-слова или отправляется на телефоны из "черного списка"
- Прокси: для Режима 2 потребуется создать прокси, который будет накапливать сообщения и отправлять их по мере появления пакетов из 10 SMS

Чуть более подробно по поводу Прокси (так как это нестандартное использование паттерна):

- у каждого Провайдера будет интерфейс (через Адаптер) с методом sendMessages(array $messages)
- для унификации в него будет передаваться массив сообщений
- при работе в Режиме 1 сообщения будут отправляться поштучно (т.е. в этот метод будет передаваться массив из одного элемента)
- при работе в Режиме 2 сообщения будет отправляться пакетами по 10 штук (т.е. в этот метод будет попадать массив из 10 элементов)

Клиенты вашего API будут использовать метод sendMessage(string $phone, string $message) и отправлять сообщения только поштучно. При этом:

- в Режиме 1 вы сразу передаёте их для отправки провайдеру в виде массива из 1 элемента
- в Режиме 2 потребуется Прокси с методом sendMessage(string $phone, string $message), который будет "копить" сообщения, пока их не наберётся 10 штук, и только после этого вызывать sendMessages(array $messages)
- для имитации процесса "накопления" можно использовать БД или файловую систему

# Установка

## Изолированное окружение

Для развёртывания изолированного окружения пропишите команду
```bash
vagrant up
```

После установки, зайдите в ОС
```bash
vagrant ssh
```

## Подготовка и запуск среды
```bash
cd /vagrant/application && cp .env.example .env
```

Далее, заполните все пустые строки нужными данными в файле `.env`

После чего выполните команду

```bash
sudo docker compose up -d
```

Добавьте сайт `mysite.local` в файл `hosts`
```bash
127.0.0.1 mysite.local
```

Готово!

# Работа с API

Для получения справки о доступных методах, перейдите по адресу `http://mysite.local/`

По урлу `http://mysite.local/queue` можно посмотреть очередь сообщений в режиме 2

По урлу `http://mysite.local/send` можно отправить сообщение. Телефон в формате `+XXXXXXXXXX` или `XXXXXXXXXX` (где `X` - цифра)

Папка `logs` содержит все отправленные сообщения в файлах `awesome.log` u `foo.log` в зависимости от выбранного провайдера

# Реализованные паттерны

Адаптер - `/src/ProviderAdapter`
Цепочка обязанностей - `/src/Middleware`
Прокси - `/src/Provider/QueueMessageProvider`